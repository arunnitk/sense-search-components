function Subscription(){this.callbackList=[]}var SenseSearchInput=function(){function a(a,b){var c=document.createElement("div");c.id=a,c.classList.add("sense-search-input-container");var d=i.replace(/{id}/gim,a);c.innerHTML=d,b=b||{};for(var e in b)this[e]=b[e];window.nlp_compromise&&"visualizations"==this.mode?this.allowNLP=!0:window.nlp_compromise||(this.allowNLP=!1),this.id=a,c.onkeyup=this.onKeyUp.bind(this),c.onkeydown=this.onKeyDown.bind(this),c.onclick=this.onClick.bind(this);var f=document.getElementById(a);if(f){f.attributes.mode&&c.setAttribute("data-mode",f.attributes.mode.value),f.insertAdjacentElement?f.insertAdjacentElement("afterEnd",c):f.insertAdjacentHTML("afterEnd",c.outerHTML);for(var g=0;g<f.attributes.length;g++)this[f.attributes[g].name]=f.attributes[g].value;f.parentNode.removeChild(f)}return this.searchFields&&!Array.isArray(this.searchFields)&&this.searchFields.length&&(this.searchFields=this.searchFields.split(",")),this.suggestFields&&!Array.isArray(this.suggestFields)&&this.suggestFields.length&&(this.suggestFields=this.suggestFields.split(",")),this.searchTimeout=this.searchTimeout||300,this.suggestTimeout=this.suggestTimeout||100,this.chartTimeout=this.chartTimeout||300,this.ready=new Subscription,senseSearch.ready.subscribe(this.activate.bind(this)),senseSearch.fieldsFetched.subscribe(this.fieldsFetched.bind(this)),senseSearch.cleared.subscribe(this.onClear.bind(this)),{element:c,object:this}}function b(a){return a.toLowerCase().replace(/ /gi,"_")}function c(a){return a.replace(/_/gi," ")}function d(a){var b=a.qText;b=b.split("");for(var c=a.qRanges.length-1;c>-1;c--)b.splice(a.qRanges[c].qCharPos+a.qRanges[c].qCharCount,0,"</span>"),b.splice(a.qRanges[c].qCharPos,0,"<span class='highlight"+a.qRanges[c].qTerm+"'>");return b=b.join("")}function e(a,b){var c=a;if(-1!=b.toLowerCase().indexOf(c.toLowerCase()));else if(b.length>c.length)for(;-1==b.toLowerCase().indexOf(c.toLowerCase());)c=c.split(" "),c.splice(0,1),c=c.join(" ");for(;c.length>=b.length&&c.toLowerCase()!=b.toLowerCase();)c=c.split(" "),c.splice(0,1),c=c.join(" ");var d=new RegExp(c,"i");return b.replace(d,"")}var f=[16,27],g=[9,13,38,40,39,37,32,33,34],h={BACKSPACE:8,ESCAPE:27,CONTROL:17,COMMAND:91,PASTE:86,TAB:9,ENTER:13,SHIFT:16,UP:38,DOWN:40,RIGHT:39,LEFT:37,DELETE:46,SPACE:32},i="<div class='sense-search-input-main'><div id='{id}_ghost' class='sense-search-input-bg'></div><input id='{id}_input' autofocus placeholder='Please wait...' disabled='disabled' type='text' autocorrect='off' autocomplete='off' autocapitalize='off' spellcheck='false' /><div id='{id}_lozenges' class='sense-search-lozenge-container'></div><div id='{id}_ambiguities' class='sense-search-ambiguity-container'></div><button type='button' class='sense-search-input-clear'>x</button></div><div id='{id}_suggestions' class='sense-search-suggestion-container'><ul id='{id}_suggestionList'></ul></div><div id='{id}_associations' class='sense-search-association-container'><ul id='{id}_associationsList'></ul></div>";return a.prototype=Object.create(Object.prototype,{id:{writable:!0,value:null},MAX_SEARCH_TERMS:{writable:!0,value:10},ready:{writable:!0,value:null},attach:{value:function(a){if(a)for(var b in a)this[b]=a[b];"visualizations"==this.mode?senseSearch.getAppFields(this.nlpModel.cardinalityLimit):this.activateInput(),senseSearch&&senseSearch.exchange.connection&&(senseSearch.searchAssociations.subscribe(this.onSearchAssociations.bind(this)),senseSearch.suggestResults.subscribe(this.onSuggestResults.bind(this)),senseSearch.inputs[this.id]||(senseSearch.inputs[this.id]=this))}},isCutCopyPaste:{writable:!0,value:!1},isPaste:{writable:!0,value:!1},searchText:{writable:!0,value:null},currentTerm:{writable:!0,value:null},searchFields:{writable:!0,value:[]},suggestFields:{writable:!0,value:[]},searchTimeout:{writable:!0,value:null},suggestTimeout:{writable:!0,value:null},chartTimeout:{writable:!0,value:null},searchTimeoutFn:{writable:!0,value:null},suggestTimeoutFn:{writable:!0,value:null},chartTimeoutFn:{writable:!0,value:null},suggesting:{writable:!0,value:!1},suggestingTimeout:{writable:!0,value:3e3},suggestingTimeoutFn:{writable:!0,value:null},activeSuggestion:{writable:!0,value:0},ghostPart:{writable:!0,value:null},ghostQuery:{writable:!0,value:null},ghostDisplay:{writable:!0,value:null},cursorPosition:{writable:!0,value:0},allowNLP:{writable:!0,value:!1},nlpTerms:{writable:!0,value:[]},nlpResolvedTerms:{writable:!0,value:{}},nlpDistinctTerms:{writable:!0,value:{}},nlpTermsIndexes:{writable:!0,value:[]},nlpTermsPositions:{writable:!0,value:[]},nlpModel:{value:{fieldNounMap:{},functionMap:{avg:"avg",average:"avg",count:"count","how many":"count",sum:"sum",total:"sum","how much":"sum",min:"min",max:"max"},distinctMap:{distinct:"DISTINCT",unique:"DISTINCT"},defaultFunction:"sum",currencySymbol:"Â£",misc:["by","as","me","not","in","and"],comparatives:{more:">",less:"<",greater:">",above:">",below:"<",cheaper:"<"},conditionals:["where","for","is","from"],sorting:["order","ordered","sort","sorted"],sortorder:{asc:1,ascending:1,desc:-1,descending:-1},vizTypeMap:{kpi:"kpi",barchart:"barchart",linechart:"linechart",piechart:"piechart",table:"table",treemap:"treemap",scatter:"scatterplot"},cardinalityLimit:1e3}},fieldsFetched:{value:function(a){console.log(senseSearch.appFieldsByTag),console.log(senseSearch.appFields),this.activateInput()}},appFields:{writable:!0,value:{}},appFieldsByTag:{writable:!0,value:{}},suggestions:{writable:!0,value:null},associations:{writable:!0,value:null},ambiguities:{writable:!0,value:null},mode:{writable:!0,value:"associations"},onClear:{value:function(){var a=document.getElementById(this.id+"_input");a&&(a.value=""),this.searchText="",this.nlpTerms=[],this.nlpResolvedTerms={},this.nlpTermsPositions=[],this.currentTerm=null,this.hideSuggestions(),this.clearLozenges()}},onSearchResults:{value:function(){}},onSearchAssociations:{value:function(a){if(this.associations=a.qResults,"associations"==this.mode)this.showAssociations();else{console.log("ambiguities"),console.log(this.associations);for(var b=this.getTermByText(this.associations.qSearchTerms[this.associations.qSearchTerms.length-1]),c=this.getTermIndexByText(this.associations.qSearchTerms[this.associations.qSearchTerms.length-1]),d=0;d<b.length;d++)if(0==this.associations.qFieldNames.length)b[d].queryTag="!!",this.buildLozenges();else if(1==this.associations.qFieldNames.length){b[d].senseTag=this.associations.qFieldNames[0],b[d].senseType="value",b[d].senseInfo={field:senseSearch.appFields[this.associations.qFieldNames[0].toLowerCase()],fieldSelection:"="};var e=c[d];this.nlpTerms[e-1]&&this.nlpTerms[e-1].text&&"not"===this.nlpTerms[e-1].text.toLowerCase()&&(b[d].senseInfo.fieldSelection="-="),this.buildLozenges(),this.nlpViz()}else b[d].senseType="?",b[d].extra={fields:this.associations.qFieldNames},this.buildLozenges()}}},onSuggestResults:{value:function(a){this.suggestions=a.qSuggestions,this.suggestions.splice(5,a.qSuggestions.length-4),this.suggestions.length>0&&(this.activeSuggestion=0),this.showSuggestions()}},getTerm:{value:function(a){return this.nlpTerms[a.replace(/ /gi,"_")]}},setCurrentTerm:{value:function(a){this.currentTerm=a[this.getCurrentTermIndex()]}},getTermByText:{value:function(a){for(var b=[],c=0;c<this.nlpTerms.length;c++)this.nlpTerms[c].text!=a||this.nlpTerms[c].senseType&&""!=this.nlpTerms[c].senseType||b.push(this.nlpTerms[c]);return b}},getTermIndexByText:{value:function(a){for(var b=[],c=0;c<this.nlpTerms.length;c++)this.nlpTerms[c].text!=a||this.nlpTerms[c].senseType&&""!=this.nlpTerms[c].senseType||b.push(c);return b}},getCurrentTermIndex:{value:function(){return this.nlpTermsPositions[this.cursorPosition-1]}},processTerms:{value:function(a,d){a=a.toLowerCase();var e=a,f=[];for(var g in senseSearch.appFields){var h,i;senseSearch.appFields[g].qInfo?(h=senseSearch.appFields[g].qData.title,i="measure"===senseSearch.appFields[g].qInfo.qType?"exp":"dim"):(h=senseSearch.appFields[g].qName,i=senseSearch.appFieldsByTag.$measure&&senseSearch.appFieldsByTag.$measure[g]?"exp":"dim");var j=b(h),k=c(j),l=a.indexOf(k),m=-1;if(-1==l&&this.nlpModel.fieldNounMap[k]&&(m=a.indexOf(this.nlpModel.fieldNounMap[k].toLowerCase()),h=this.nlpModel.fieldNounMap[k],k=this.nlpModel.fieldNounMap[k].toLowerCase()),-1!==l||-1!==m){var n=-1===l?m:l;e=e.replace(k,";||"+k+";");var o={name:g,text:h,parsedText:k,position:n,length:h.length,senseType:i,queryTag:i,senseInfo:{field:senseSearch.appFields[g]}};senseSearch.appFieldsByTag.$time&&senseSearch.appFieldsByTag.$time[g]&&(o.senseInfo.type="time"),f.push(o)}}var p=e.split(";"),q=[];console.log(p);for(var r=0;r<p.length;r++){var s=0;if(s=0==r?0:q[r-1]+p[r-1].replace("||","").length,q.push(s),-1==p[r].indexOf("||")&&p[r].length>0)for(var t=p[r].split(" "),u=0,v=0;v<t.length;v++)0==v&&" "==p[r].split()[0]?u=1:u++,t[v].length>0&&f.push({name:t[v],text:t[v],parsedText:t[v],position:s+u,length:t[v].length}),u+=t[v].length}f.sort(function(a,b){return a.position<b.position?-1:a.position>b.position?1:0}),this.createTermPosArray(f),this.nlpTerms=[];for(var w=0;w<f.length;w++)if(this.nlpResolvedTerms[f[w].name])this.nlpTerms.push(this.nlpResolvedTerms[f[w].name]);else{var x=this.tagTerm(f[w]);this.nlpTerms.push(x)}console.log(this.nlpTerms)}},createTermPosArray:{value:function(a){this.nlpTermsPositions=[];for(var b=0;b<a.length;b++){for(var c=a[b].text.split(""),d=0;d<c.length;d++)this.nlpTermsPositions.push(b);b<a.length-1?this.nlpTermsPositions.push(-1):b==a.length-1&&" "==this.searchText.split("").pop&&this.nlpTermsPositions.push(-1)}console.log(this.nlpTermsPositions)}},tagTerm:{value:function(a){var b=a.text.toLowerCase(),c=this.getCurrentTermIndex();return a.queryTag||(this.nlpModel.functionMap[b]?(a.senseType="function",a.senseInfo={func:this.nlpModel.functionMap[b]},a.queryTag="function"):-1!=this.nlpModel.sorting.indexOf(b)?a.queryTag="sorting":this.nlpModel.sortorder[b]?(a.queryTag="sortorder",this.nlpTerms[c-1]&&"sort by"===this.nlpTerms[c-1].queryTag?this.nlpTerms[c-1].senseInfo.order=this.nlpModel.sortorder[b]:(a.senseType="sortorder",a.senseInfo={order:this.nlpModel.sortorder[b]})):this.nlpModel.vizTypeMap[b]?(a.queryTag="viz",a.senseType="viz",a.senseInfo={viz:this.nlpModel.vizTypeMap[b]}):this.nlpModel.distinctMap[b]?a.queryTag="distinct":this.nlpModel.comparatives[b]?a.queryTag="!":-1!=this.nlpModel.conditionals.indexOf(b)?a.queryTag="!":-1!=this.nlpModel.misc.indexOf(b)&&(a.queryTag="!")),a}},clear:{value:function(){senseSearch.clear()}},onClick:{value:function(a){if(console.log(a),a.target.classList.contains("sense-search-input-clear"))this.clear();else if(a.target.classList.contains("sense-search-suggestion-item"))this.activeSuggestion=parseInt(a.target.attributes["data-index"].value),this.drawGhost(),this.acceptSuggestion();else if(a.target.classList.contains("sense-search-association-item")||a.target.parentNode.classList.contains("sense-search-association-item")||a.target.parentNode.parentNode.classList.contains("sense-search-association-item")){var c;c=a.target.classList.contains("sense-search-association-item")?parseInt(a.target.attributes["data-index"].value):a.target.parentNode.classList.contains("sense-search-association-item")?parseInt(a.target.parentNode.attributes["data-index"].value):parseInt(a.target.parentNode.parentNode.attributes["data-index"].value),senseSearch.selectAssociations(this.searchFields||[],c),this.hideAssociations(),this.hideSuggestions()}else if(a.target.classList.contains("ambiguity")){console.log(a);var d=a.target.attributes["data-term"].value,e=document.getElementById("ambiguous_"+d.replace(/ /gi,"_"));e&&(e.style.display="initial")}else if(a.target.classList.contains("ambiguous_resolve")){var d=a.target.attributes["data-term"].value,f=a.target.innerText;this.nlpTerms[d].senseType="value",this.nlpTerms[d].queryTag=f,this.nlpTerms[d].senseInfo={field:senseSearch.appFields[b(f)],fieldSelection:"="},this.nlpTerms[d-1]&&this.nlpTerms[d-1].text&&"not"===this.nlpTerms[d-1].text.toLowerCase()&&(this.nlpTerms[d].senseInfo.fieldSelection="-="),this.nlpResolvedTerms[this.nlpTerms[d].name]=this.nlpTerms[d],this.buildLozenges(),this.nlpViz()}}},onKeyDown:{value:function(a){if(console.log(a.keyCode),a.keyCode==h.ESCAPE)return void this.hideSuggestions();if(a.keyCode==h.CONTROL||a.keyCode==h.COMMAND)return void(this.isCutCopyPaste=!0);if(a.keyCode==h.PASTE&&this.isCutCopyPaste)return void(this.isPaste=!0);if(a.keyCode==h.DOWN)this.showSuggestions();else if(a.keyCode==h.RIGHT)this.suggesting&&(a.preventDefault(),this.nextSuggestion());else if(a.keyCode==h.LEFT)this.suggesting&&(a.preventDefault(),this.prevSuggestion());else if(a.keyCode==h.ENTER||a.keyCode==h.TAB)this.suggesting&&(a.preventDefault(),this.acceptSuggestion());else if(a.keyCode==h.SPACE){if(this.searchText.split(" ").length==this.MAX_SEARCH_TERMS)return alert("Too many search terms"),a.preventDefault(),!1;if(1==this.searchText.split(" ").pop().length)return alert("cannot search for single character strings"),a.preventDefault(),!1;this.hideSuggestions(),this.hideAssociations()}else this.hideSuggestions(),this.hideAssociations()}},onKeyUp:{value:function(a){a.keyCode==h.Control&&(this.isCutCopyPaste=!1);var b=document.getElementById(this.id+"_input");b&&(this.searchText=b.value,this.cursorPosition=a.target.selectionStart,"visualizations"===this.mode&&(this.processTerms(this.searchText,!this.isPaste),this.buildLozenges(),this.isPaste=!1),-1==f.indexOf(a.keyCode)&&-1==g.indexOf(a.keyCode)&&("visualizations"===this.mode?this.preVizSearch():this.preSearch()))}},preSearch:{value:function(){if(this.searchText&&this.searchText.length>0){if(this.searchText.split(" ").pop().length>1){var a=this;this.searchTimeoutFn&&clearTimeout(this.searchTimeoutFn),this.searchTimeoutFn=setTimeout(function(){a.search()},this.searchTimeout),this.searchText.length>1&&this.cursorPosition==this.searchText.length&&(this.suggestTimeoutFn&&clearTimeout(this.suggestTimeoutFn),this.suggestTimeoutFn=setTimeout(function(){a.suggest()},this.suggestTimeout))}}else this.clear()}},preVizSearch:{value:function(){if(this.searchText&&this.searchText.trim().length>1){var a=this;this.searchTimeoutFn&&clearTimeout(this.searchTimeoutFn),this.searchTimeoutFn=setTimeout(function(){for(var b=0;b<a.nlpTerms.length;b++)a.nlpTerms[b].senseType||a.nlpTerms[b].queryTag||a.searchForSingleTerm(a.nlpTerms[b].text)},this.searchTimeout),this.chartTimeoutFn&&clearTimeout(this.chartTimeoutFn),this.chartTimeoutFn=setTimeout(function(){a.nlpViz()},this.chartTimeout)}this.searchText&&0!=this.searchText.length||this.clear()}},setSearchText:{value:function(a){this.searchText=a,this.isPaste=!0,this.cursorPosition=a.length;var b=document.getElementById(this.id+"_input");b&&(b.value=a),"visualizations"===this.mode?(this.processTerms(this.searchText,!this.isPaste),this.buildLozenges(),this.preVizSearch()):this.preSearch(),this.isPaste=!1}},showSuggestions:{value:function(){if(this.startSuggestionTimeout(),this.searchText&&this.searchText.length>1&&this.cursorPosition==this.searchText.length&&this.suggestions.length>0){this.suggesting=!0,this.drawGhost();var a=document.getElementById(this.id+"_suggestions");a&&(a.style.display="block"),this.drawSuggestions()}else this.suggesting=!1,this.removeGhost(),this.hideSuggestions()}},hideSuggestions:{value:function(){this.suggesting=!1,this.activeSuggestion=0,this.ghostPart="",this.ghostQuery="",this.ghostDisplay="",this.removeGhost();var a=document.getElementById(this.id+"_suggestions");a&&(a.style.display="none")}},showAssociations:{value:function(){for(var a="",b=0;b<this.associations.qSearchTermsMatched.length;b++)for(var c=this.associations.qSearchTermsMatched[b],e=0;e<c.length;e++){a+="<li class='sense-search-association-item' data-index='"+e+"'>";for(var f=0;f<c[e].qFieldMatches.length;f++){var g=c[e].qFieldMatches.length>1?"small":"",h=c[e].qFieldMatches[f],i=this.associations.qFieldNames[h.qField],j=[];for(var k in h.qValues){var l=d(this.associations.qFieldDictionaries[h.qField].qResult[k],h.qTerms);j.push(l)}a+="<div class='"+g+"'>",a+="<h1>"+i+"</h1>";for(var k=0;k<j.length;k++)a+=j[k],k<j.length-1&&(a+=", ");a+="</div>"}a+="</li>"}var m=document.getElementById(this.id+"_associationsList");m&&(m.innerHTML=a);var n=document.getElementById(this.id+"_associations");n&&(n.style.display="block")}},hideAssociations:{value:function(){var a=document.getElementById(this.id+"_associations");a&&(a.style.display="none")}},buildLozenges:{value:function(){var a="",b="";for(var c in this.nlpTerms){if(a+="<div class='lozenge' ",this.nlpTerms[c].queryTag&&""!==this.nlpTerms[c].queryTag&&(a+=" data-querytag='"+this.nlpTerms[c].queryTag+"'"),this.nlpTerms[c].senseType&&""!==this.nlpTerms[c].senseType&&(a+=" data-sensetag='"+this.nlpTerms[c].senseType+"'"),a+=">",a+=this.nlpTerms[c].parsedText,a+="</div>",b+="<div class='ambiguity-provision' data-querytag='"+this.nlpTerms[c].queryTag+"'>",b+=this.nlpTerms[c].parsedText,"?"==this.nlpTerms[c].senseType){b+="<div class='ambiguity' data-term='"+c+"'>?</div>",b+="<ul id='ambiguous_"+c.replace(/ /gi,"_")+"' style='display: none;'>";for(var d=0;d<this.nlpTerms[c].extra.fields.length;d++)b+="<li class='ambiguous_resolve' data-term='"+c+"'>",b+=this.nlpTerms[c].extra.fields[d],b+="</li>"}b+="</ul>",b+="</div>"}var e=document.getElementById(this.id+"_lozenges");e&&(e.innerHTML=a);var f=document.getElementById(this.id+"_ambiguities");f&&(f.innerHTML=b)}},clearLozenges:{value:function(){var a=document.getElementById(this.id+"_lozenges");a&&(a.innerHTML="");var b=document.getElementById(this.id+"_ambiguities");b&&(b.innerHTML="")}},startSuggestionTimeout:{value:function(){this.suggestingTimeoutFn&&clearTimeout(this.suggestingTimeoutFn),this.suggestingTimeoutFn=setTimeout(function(){"associations"!==this.mode&&this.hideSuggestions.call(this)}.bind(this),this.suggestingTimeout)}},nextSuggestion:{value:function(){this.startSuggestionTimeout(),this.activeSuggestion==this.suggestions.length-1?this.activeSuggestion=0:this.activeSuggestion++,this.drawGhost(),this.highlightActiveSuggestion()}},prevSuggestion:{value:function(){this.startSuggestionTimeout(),0==this.activeSuggestion?this.activeSuggestion=this.suggestions.length-1:this.activeSuggestion--,this.drawGhost(),this.highlightActiveSuggestion()}},acceptSuggestion:{value:function(){this.searchText=this.ghostQuery,this.suggestions=[],this.hideSuggestions();var a=document.getElementById(this.id+"_input");a&&(a.value=this.searchText),this.search()}},search:{value:function(){senseSearch.search(this.searchText,this.searchFields||[],this.mode)}},searchForSingleTerm:{value:function(a){senseSearch.search(a,this.searchFields||[],this.mode)}},suggest:{value:function(){senseSearch.suggest(this.searchText,this.suggestFields||[])}},nlpViz:{value:function(){console.log("creating viz");for(var a,c={qInfo:{},qHyperCubeDef:{qDimensions:[],qMeasures:[],qInitialDataFetch:[{qTop:0,qLeft:0,qHeight:1e3,qWidth:10}]}},d={},e={},f=[],g={},h={},i=0,j=[],k=null,l=null,m={},n={},o=0,p=0,q=0;q<this.nlpTerms.length;q++)"exp"==this.nlpTerms[q].senseType&&p++,"dim"==this.nlpTerms[q].senseType&&this.nlpTerms[q-1]&&(this.nlpModel.distinctMap[this.nlpTerms[q-1].text]?(this.nlpTerms[q].senseType="exp",this.nlpTerms[q].senseInfo.countDistinct=!0,this.nlpTerms[q].senseInfo.func="count",p++):"function"==this.nlpTerms[q-1].senseType&&(this.nlpTerms[q].senseType="exp",this.nlpTerms[q].senseInfo.func=this.nlpTerms[q-1].senseInfo.func,p++));if(0==p)for(var q=0;q<this.nlpTerms.length;q++)0==p&&"dim"==this.nlpTerms[q].senseType&&senseSearch.appFieldsByTag.$possibleMeasure&&senseSearch.appFieldsByTag.$possibleMeasure[this.nlpTerms[q].parsedText]&&(this.nlpTerms[q].senseType="exp",p++,senseSearch.appFieldsByTag.$numeric&&senseSearch.appFieldsByTag.$numeric[this.nlpTerms[q].parsedText]?this.nlpTerms[q].senseInfo.func=this.nlpModel.defaultFunction:this.nlpTerms[q].senseInfo.func="count");o=-1,p=-1;for(var q=0;q<this.nlpTerms.length;q++)switch(this.nlpTerms[q].senseType){case"exp":var r=this.nlpTerms[q],s=r.name;r.senseInfo.field.qInfo?e[s]={qLibraryId:r.senseInfo.field.qInfo.qId,qLabel:s}:(s=this.nlpTerms[q].senseInfo.field.qName.replace(/ /gi,"-"),e[s]={field:this.nlpTerms[q].senseInfo.field},this.nlpTerms[q].senseInfo.countDistinct&&(e[s].isCountDistinct=!0),this.nlpTerms[q].senseInfo.func&&(e[s].func=this.nlpTerms[q].senseInfo.func)),p++,n[s]=p;break;case"dim":var t=this.nlpTerms[q],u=this.nlpTerms[q].name;t.senseInfo.field.qInfo?d[u]={qLibraryId:t.senseInfo.field.qInfo.qId}:(u=this.nlpTerms[q].senseInfo.field.qName.replace(/ /gi,"-"),d[u]=this.nlpTerms[q].senseInfo.field,"time"==this.nlpTerms[q].senseInfo.type&&j.push(u)),o++,m[u]=o;break;case"function":k=this.nlpTerms[q].senseInfo.func;break;case"viz":a=this.nlpTerms[q].senseInfo.viz;break;case"value":var v,w;this.nlpTerms[q].senseInfo.field.qInfo?(w=b(this.nlpTerms[q].senseInfo.field.qData.title),v=this.nlpTerms[q].senseInfo.field.qData.title):(w=b(this.nlpTerms[q].senseInfo.field.qName),v=this.nlpTerms[q].senseInfo.field.qName),h[w]||(h[w]={field:v,selector:this.nlpTerms[q].senseInfo.fieldSelection,values:[]});var x="";x+="'",x+=this.nlpTerms[q].text,x+="*'",h[w].values.push(x),i++;break;case"sortfield":var y=this.nlpTerms[q].senseInfo.field.qName.replace(/ /gi,"-");g[y]=this.nlpTerms[q].senseInfo;break;case"sortorder":l=this.nlpTerms[q].senseInfo.order}for(var z in d){var A={};if(A=d[z].qLibraryId?d[z]:{qDef:{qFieldDefs:[d[z].qName]},qNullSuppression:!0},g[z]){var B="qSortByAscii",C=g[z].order||1;senseSearch.appFieldsByTag.$numeric&&-1!=senseSearch.appFieldsByTag.$numeric.indexOf(z)&&(B="qSortByNumeric"),A.qDef.qSortCriterias=[{}],A.qDef.qSortCriterias[0][B]=C}c.qHyperCubeDef.qDimensions.push(A),f.push(d[z].qName)}for(var D in e){var E={};if(e[D].qLibraryId)E.qDef=e[D];else{var F="=num(";if(F+=e[D].func||k||this.nlpModel.defaultFunction,F+="(",e[D].isCountDistinct&&(F+="DISTINCT "),F+="{$",i>0){F+="<";for(var G in h)F+="["+h[G].field+"]",F+=h[G].selector,F+="{",F+=h[G].values.join(","),F+="}";F+=">"}F+="}",F+="["+e[D].field.qName+"]",F+="), '",senseSearch.appFieldsByTag.$currency&&senseSearch.appFieldsByTag.$currency[D]&&"count"!==k&&(F+=this.nlpModel.currencySymbol),F+="#,##0')";var E={qDef:{qDef:F,label:e[D].field.qName}};if(f.push(e[D].field.qName),g[D]){var B="qSortByNumeric",C=g[D].order||1;E.qSortBy={},E.qSortBy[B]=C,c.qHyperCubeDef.qInterColumnSortOrder=[f.indexOf(e[D].field.qName)]}}c.qHyperCubeDef.qMeasures.push(E)}var H=0;for(var G in g)H++;if(0==H)if(j.length>0){var I=m[j[0]];c.qHyperCubeDef.qDimensions[I].qDef.qSortCriterias=[{qSortByNumeric:l||1}],c.qHyperCubeDef.qInterColumnSortOrder=[f.indexOf(j[0])]}else c.qHyperCubeDef.qMeasures.length>0?(c.qHyperCubeDef.qMeasures[0].qSortBy={qSortByNumeric:l||-1},c.qHyperCubeDef.qInterColumnSortOrder=[f.indexOf(c.qHyperCubeDef.qMeasures[0].qDef.label)]):c.qHyperCubeDef.qDimensions.length>0;var J=c.qHyperCubeDef.qDimensions.length+c.qHyperCubeDef.qMeasures.length;a||(a=1==J?this.nlpModel.vizTypeMap.kpi:c.qHyperCubeDef.qMeasures.length>0?j.length>0?this.nlpModel.vizTypeMap.linechart:this.nlpModel.vizTypeMap.barchart:this.nlpModel.vizTypeMap.table),c.qInfo.qType=a,"table"==c.qInfo.qType,(c.qHyperCubeDef.qDimensions.length>0||c.qHyperCubeDef.qMeasures.length>0)&&senseSearch.createViz(c)}},drawGhost:{value:function(){this.ghostPart=e(this.searchText,this.suggestions[this.activeSuggestion].qValue),this.ghostQuery=this.searchText+this.ghostPart;var a="<span style='color: transparent;'>"+this.searchText+"</span>"+this.ghostPart,b=document.getElementById(this.id+"_ghost");b&&(b.innerHTML=a)}},removeGhost:{value:function(){var a=document.getElementById(this.id+"_ghost");a&&(a.innerHTML="")}},drawSuggestions:{value:function(){for(var a="",b=0;b<this.suggestions.length;b++)a+="<li id='"+this.id+"_suggestion_"+b+"' class='sense-search-suggestion-item' data-index='"+b+"'>",a+=this.suggestions[b].qValue,a+="</li>";var c=document.getElementById(this.id+"_suggestionList");c&&(c.innerHTML=a),this.highlightActiveSuggestion()}},highlightActiveSuggestion:{value:function(){var a=document.getElementById(this.id+"_suggestionList");if(a)for(var b=0;b<a.childElementCount;b++)a.childNodes[b].classList.remove("active");var c=document.getElementById(this.id+"_suggestion_"+this.activeSuggestion);c&&c.classList.add("active")}},activate:{value:function(){this.attach()}},activateInput:{value:function(){var a=document.getElementById(this.id+"_input");a&&(a.attributes.placeholder.value=this.placeholder||"Enter up to "+this.MAX_SEARCH_TERMS+" search terms",a.disabled=!1,console.log("input activated"),this.ready.deliver())}}}),a}(),SenseSearchResult=function(){function a(a,b){var c=document.createElement("div");c.id=a,c.classList.add("sense-search-results-container"),this.resultsElement=a+"_results",this.loadingElement=a+"_results_loading";var e=d.replace(/{id}/gim,a);c.innerHTML=e,b=b||{};for(var f in b)this[f]=b[f];this.id=a;var g=document.getElementById(a);if(g){g.insertAdjacentElement?g.insertAdjacentElement("afterEnd",c):g.insertAdjacentHTML("afterEnd",c.outerHTML);for(var h=0;h<g.attributes.length;h++)this[g.attributes[h].name]=g.attributes[h].value;g.parentNode.removeChild(g)}return senseSearch.ready.subscribe(this.activate.bind(this)),{element:c,object:this}}function b(a,b){for(var c=[],d=0;d<a.length;d++)if(a[d].dimension){var e={qDef:{qFieldDefs:[a[d].dimension]},qNullSuppression:a[d].suppressNull};if(b[a[d].dimension]){var f={};f[b[a[d].dimension].sortType]=b[a[d].dimension].order,b[a[d].dimension].sortExpression&&(f.qExpression=b[a[d].dimension].sortExpression),e.qDef.qSortCriterias=[f]}c.push(e)}return c}function c(a){for(var b=[],c=0;c<a.length;c++)if(a[c].measure){var d={qDef:{qLabel:a[c].label,qDescription:"",qDef:a[c].measure}};a[c].sortType&&(d.qSortBy={},d.qSortBy[a[c].sortType]=a[c].order),b.push(d)}return b}var d="<div id='{id}_results_loading' class='sense-search-results_loading on'><div class='sense-search-results_loading-spinner'>Loading...</div></div><div id='{id}_results' class='sense-search-results'></div>";return a.prototype=Object.create(Object.prototype,{id:{writable:!0,value:!1},handle:{writable:!0,value:!1},activate:{value:function(){this.attach()}},attached:{writable:!0,value:!1},attach:{value:function(a,b){var c=this;if(a)for(var d in a)this[d]=a[d];if(senseSearch&&senseSearch.exchange.connection){if(a&&a.fields){var e=this.buildHyperCubeDef();senseSearch.exchange.ask(senseSearch.appHandle,"CreateSessionObject",[e],function(a){c.handle=a.result.qReturn.qHandle,"function"==typeof b&&b.call(null)})}this.attached||(senseSearch.searchStarted.subscribe(this.onSearchStarted.bind(this)),senseSearch.searchResults.subscribe(this.onSearchResults.bind(this)),senseSearch.noResults.subscribe(this.onNoResults.bind(this)),senseSearch.chartResults.subscribe(this.onChartResults.bind(this)),senseSearch.cleared.subscribe(this.onClear.bind(this)),this.attached=!0),senseSearch.results[this.id]=this}this.hideLoading()}},fields:{writable:!0,value:[]},data:{writable:!0,value:[]},sortOptions:{writable:!0,value:{}},defaultSort:{writable:!0,value:null},currentSort:{writable:!0,value:null},enableHighlighting:{writable:!0,value:!0},pageTop:{writable:!0,value:0},pageSize:{writable:!0,value:20},buildHyperCubeDef:{value:function(){var a={qInfo:{qType:"table"},qHyperCubeDef:{qDimensions:b(this.fields,this.sortOptions),qMeasures:c(this.fields),qSuppressZero:!1,qSuppressMissing:!1,qInterColumnSortOrder:[this.getFieldIndex(this.defaultSort).index]}};return a}},resultsElement:{writable:!0,value:null},showLoading:{value:function(){var a=document.getElementById(this.loadingElement);a&&a.classList.add("on")}},hideLoading:{value:function(){var a=document.getElementById(this.loadingElement);a&&a.classList.remove("on")}},onSearchStarted:{value:function(){this.showLoading()}},onSearchResults:{value:function(a){this.hideLoading(),this.data=[],this.pageTop=0,this.getHyperCubeData()}},onChartResults:{value:function(a){console.log("Chart created"),console.log(a),this.hideLoading();var b=document.createElement("div");b.classList.add("chart-result");var c=document.getElementById(this.resultsElement);c.innerHTML="",c&&c.appendChild(b),"CapabilityAPI"==senseSearch.exchange.connectionType&&a.show(b)}},onNoResults:{value:function(){this.hideLoading(),this.renderItems([])}},onClear:{value:function(){this.hideLoading(),document.getElementById(this.id+"_results").innerHTML=""}},getNextBatch:{value:function(){this.pageTop+=this.pageSize,this.getHyperCubeData()}},getHyperCubeData:{value:function(a){var b=this;senseSearch.exchange.getLayout(this.handle,function(c){var d=c.result.qLayout,e=d.qHyperCube.qDimensionInfo.concat(d.qHyperCube.qMeasureInfo);senseSearch.exchange.ask(b.handle,"GetHyperCubeData",["/qHyperCubeDef",[{qTop:b.pageTop,qLeft:0,qHeight:b.pageSize,qWidth:b.fields.length}]],function(c){if(a&&"function"==typeof a)a.call(this,c);else{for(var d=c.result.qDataPages,f=[],g=0;g<d[0].qMatrix.length;g++){var h={};if(!this.nullSuppressor||null==this.nullSuppressor||"-"!=d[0].qMatrix[g][$scope.config.nullSuppressor].qText){for(var i=0;i<d[0].qMatrix[g].length;i++)h[e[i].qFallbackTitle]={value:d[0].qMatrix[g][i].qText,html:b.highlightText(d[0].qMatrix[g][i].qText)};f.push(h)}}b.data=b.data.concat(f),b.renderItems(f)}})})}},getFieldIndex:{value:function(a){for(var b=0;b<this.fields.length;b++){if(this.fields[b].dimension&&this.fields[b].dimension==a)return{index:b,type:"dimension"};if(this.fields[b].label&&this.fields[b].label==a)return{index:b,type:"measure"}}return 0}},highlightText:{value:function(a){if(senseSearch.terms&&this.enableHighlighting){for(var b=senseSearch.terms,c=0;c<b.length;c++)a=a.replace(new RegExp(b[c],"i"),"<span class='highlight"+c+"'>"+b[c]+"</span>");return a}return a}},renderItems:{writable:!0,value:function(a){if(this.data.length>0){var b=document.getElementById(this.id+"_ul");b||(b=document.createElement("ul"),b.id=this.id+"_ul",document.getElementById(this.id+"_results").appendChild(b));var c="",d=0;for(var e in a[0])d++;var f=Math.floor(100/d);c+="<li>";for(var g in a[0])c+="<div class='sense-search-result-cell' style='width: "+f+"%'>",c+="<strong>"+g+"</strong>",c+="</div>";c+="</li>";for(var h=0;h<a.length;h++){c+="<li>";for(var g in a[h])c+="<div class='sense-search-result-cell' style='width: "+f+"%'>",c+=a[h][g].html,c+="</div>";c+="</li>"}document.getElementById(this.id+"_ul").innerHTML=c}else c="<h1>No Results</h1>",document.getElementById(this.resultsElement).innerHTML=c}},applySort:{value:function(a,b,c){var d=this;b=b||!1,c=c||!1,senseSearch.exchange.ask(this.handle,"ApplyPatches",[[{qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:[d.getFieldIndex(a).index]}],!0],function(){b&&(d.pageTop=0),c&&1==c&&d.getHyperCubeData()})}},invertSort:{value:function(a,b,c){var d,e=this,f=this.getFieldIndex(a);d="dimension"==f.type?"/qHyperCubeDef/qDimensions/"+f.index+"/qDef/qReverseSort":"/qHyperCubeDef/qMeasures/"+f.index+"/qDef/qReverseSort";var e=this;b=b||!1,c=c||!1,senseSearch.exchange.ask(this.handle,"ApplyPatches",[[{qPath:"/qHyperCubeDef/qInterColumnSortOrder",qOp:"replace",qValue:"["+e.getFieldIndex(a).index+"]"},{qPath:d,qOp:"replace",qValue:"true"}],!0],function(){b&&(e.pageTop=0),c&&1==c&&e.getHyperCubeData()})}}}),a}();Subscription.prototype=Object.create(Object.prototype,{subscribe:{value:function(a){this.callbackList.push(a)}},deliver:{value:function(a){for(var b=0;b<this.callbackList.length;b++)this.callbackList[b].call(null,a)}}});var SenseSearch=function(){function a(){var a,b,c=0,d=10;this.connect=function(e,f){b=f;try{a=new WebSocket(e)}catch(g){}a.onopen=function(){console.log("Socket connected! readyState = "+a.readyState),c=0,b.call(null,{method:"connected"})},a.onmessage=function(a){var c;c=a.data,b.call(null,JSON.parse(c))},a.onerror=function(a){b.call(null,null)},a.onclose=function(e){d>c?(c++,console.warn("Socket closed! --> Reconnect in 5 secs (retry "+c+")"),setTimeout(function(){3===a.readyState&&b.call(null,{
method:"socketClosed",isConnecting:!1})},5e3)):(console.warn("Sorry, can't reconnect socket aftet "+d+" retries"),c=0)}},this.sendMessage=function(c,d){b=d;try{a.send(JSON.stringify(c))}catch(e){throw e}}}function b(){this.ready=new Subscription,this.searchStarted=new Subscription,this.searchResults=new Subscription,this.searchAssociations=new Subscription,this.fieldsFetched=new Subscription,this.noResults=new Subscription,this.suggestResults=new Subscription,this.chartResults=new Subscription,this.cleared=new Subscription}var c=function(){function b(b,c){if(!b.app)return!1;b=b||{},b.host?b.port=b.port||"":b.port="4848",b.host=b.host||"localhost",b.prefix=b.prefix||"",b.isSecure=b.isSecure||"https:"==window.location.protocol,b.ticket=b.ticket||!1;var d="ws";d+=b.isSecure?"s://":"://",d+=b.host,d+=b.port?":"+b.port:"",d+=b.prefix,d+="/app/",d+=b.app,d+=b.ticket?"qlikTicket="+b.ticket:"",this.connection=new a,this.connection.connect(d,c)}return b.prototype=Object.create(Object.prototype,{connection:{writable:!0,value:null},ask:{value:function(a,b,c,d,e){var f={id:d,handle:a,method:b,params:c};this.connection.sendMessage(f,e)}}}),b}(),d=function(){function a(a,b,d){var e=this;this.connectionType=b,"Native"==b?this.connection=new c(a,function(){e.connection.ask(-1,"OpenDoc",[a.app],0,function(a){d.call(null,a)})}):"QSocks"==b?(this.connection=a,this.seqId=this.connection.seqid):"CapabilityAPI"==b&&(this.connection=a.global.session,this.app=a)}return a.prototype=Object.create(Object.prototype,{connectionType:{writable:!0,value:null},seqId:{writable:!0,value:0},pendingCallbacks:{writable:!0,value:{}},connection:{writable:!0,value:null},ask:{value:function(a,b,c,d){switch(this.connectionType){case"Native":this.askNative(a,b,c,d);break;case"QSocks":this.askQSocks(a,b,c,d);break;case"CapabilityAPI":this.askCapabilityAPI(a,b,c,d)}"Native"==this.connectionType}},createCapabilityViz:{value:function(){}},askNative:{value:function(a,b,c,d){var e=this;this.seqId++,this.pendingCallbacks[this.seqId]=d,this.connection.ask(a,b,c,this.seqId,function(a){if(a.error);else{var b=e.pendingCallbacks[a.id];b&&(b.call(null,a),delete e.pendingCallbacks[a.id])}})}},askQSocks:{value:function(a,b,c,d){this.seqId++,this.connection.seqid++,this.connection.ask(a,b,c,this.seqId).then(function(a){a.error||d.call(null,a)})}},askCapabilityAPI:{value:function(a,b,c,d){var e=this;this.connection.rpc({handle:a,method:b,params:c}).then(function(a){e.seqId=a.id,a.error||d.call(null,a)})}},getLayout:{value:function(a,b){this.ask(a,"GetLayout",[],b)}}}),a}();return b.prototype=Object.create(Object.prototype,{init:{value:function(){for(var a=document.getElementsByTagName("sense-search-input"),b=0;b<a.length;){var c=a[b].id,d=new SenseSearchInput(c);this.inputs[c]=d.object}for(var e=document.getElementsByTagName("sense-search-results"),b=0;b<e.length;){var c=e[b].id,f=new SenseSearchResult(c);this.results[c]=f.object}}},appFields:{writable:!0,value:{}},appFieldsByTag:{writable:!0,value:{}},inputs:{writable:!0,value:{}},results:{writable:!0,value:{}},pendingSearch:{writable:!0,value:null},pendingSuggest:{writable:!0,value:null},pendingChart:{writable:!0,value:null},appHandle:{writable:!0,value:null},exchange:{writable:!0,value:null},connect:{value:function(a,b){var c=this;this.exchange=new d(a,"Native",function(a){a.result&&a.result.qReturn&&(c.appHandle=a.result.qReturn.qHandle,c.ready.subscribe(b),c.ready.deliver())})}},connectWithQSocks:{value:function(a){this.appHandle=a.handle,this.exchange=new d(a.connection,"QSocks"),this.ready.deliver()}},connectWithCapabilityAPI:{value:function(a){this.appHandle=a.global.session.connectedAppHandle,this.exchange=new d(a,"CapabilityAPI"),this.ready.deliver(),console.log(a)}},readOptions:{value:function(a){for(var b in a)this[0]=a[b]}},ready:{writable:!0,value:null},newResultsDefinition:{value:function(a,b,c){var d=new Result(a);this.results.push(d)}},fieldsFetched:{writable:!0,value:null},search:{value:function(a,b,c,d){this.searchStarted.deliver();var e=this;c=c||"simple",d=d||this.context||"LockedFieldsOnly",this.pendingSearch=this.exchange.seqId+1,this.terms=a.split(" "),this.exchange.ask(this.appHandle,"SearchAssociations",[{qContext:d,qSearchFields:b},this.terms,{qOffset:0,qCount:5,qMaxNbrFieldMatches:5}],function(f){"visualizations"==c?e.searchAssociations.deliver(f.result):f.id==e.pendingSearch&&(""==a||f.result.qResults.qTotalSearchResults>0?"simple"==c?e.selectAssociations(b,0,d):e.searchAssociations.deliver(f.result):e.noResults.deliver())})}},selectAssociations:{value:function(a,b,c){c=c||this.context||"LockedFieldsOnly";var d=this;d.exchange.ask(d.appHandle,"SelectAssociations",[{qContext:c,qSearchFields:a},d.terms,b],function(a){d.searchResults.deliver(a.change)})}},suggest:{value:function(a,b,c){var d=this;d.pendingSuggest=this.exchange.seqId+1,this.exchange.ask(this.appHandle,"SearchSuggest",[{qContext:c||this.context||"LockedFieldsOnly",qSearchFields:b},a.split(" ")],function(a){a.id==d.pendingSuggest&&d.suggestResults.deliver(a.result.qResult)})}},createViz:{value:function(a){this.searchStarted.deliver();var b=this;if(b.pendingChart=this.exchange.seqId+1,"CapabilityAPI"==this.exchange.connectionType){var c=[],d=a;d.wsId=b.pendingChart,"kpi"==a.qInfo.qType&&(d.qHyperCubeDef.qMeasures[0].qDef.measureAxis={min:0,max:100},d.qHyperCubeDef.qMeasures[0].qDef.conditionalColoring={useConditionalColoring:!1,singleColor:3,segments:{colors:{color:3},limits:[]}},d.fontSize="S"),this.exchange.app.visualization.create(a.qInfo.qType,c,d).then(function(a){console.log(a),b.exchange.ask(a.model.handle,"ApplyPatches",[[{qPath:"/qHyperCubeDef",qOp:"replace",qValue:JSON.stringify(d.qHyperCubeDef)}],!0],function(c){a.model.getLayout().then(function(){b.chartResults.deliver(a)})})})}else this.exchange.ask(this.appHandle,"CreateSessionObject",[a],function(a){a.id==b.pendingChart&&b.chartResults.deliver(a.result.qReturn)})}},clear:{value:function(){this.terms=null,this.cleared.deliver()}},getAppFields:{value:function(a){var b=this,c=2,d={fields:null,dimensions:null,measures:null,setCount:0};b.exchange.ask(b.appHandle,"CreateSessionObject",[{qInfo:{qType:"FieldList"},qFieldListDef:{qShowSystem:!1}}],function(e){var f=e.result.qReturn.qHandle;b.exchange.ask(f,"GetLayout",[],function(e){d.fields=e.result.qLayout.qFieldList.qItems,d.setCount++,d.setCount===c&&b.sortFieldsByTag(d,a)})}),b.exchange.ask(b.appHandle,"CreateSessionObject",[{qInfo:{qType:"DimensionList"},qDimensionListDef:{qType:"dimension",qData:{title:"/qMetaDef/title",tags:"/qMetaDef/tags",grouping:"/qDim/qGrouping",info:"/qDimInfos"}}}],function(e){var f=e.result.qReturn.qHandle;b.exchange.ask(f,"GetLayout",[],function(e){d.dimensions=e.result.qLayout.qDimensionList.qItems,d.setCount++,d.setCount===c&&b.sortFieldsByTag(d,a)})}),d.measures=[]}},sortFieldsByTag:{value:function(a,b){for(var c=0;c<a.fields.length;c++){var d=a.fields[c].qName.toLowerCase().replace(/ /gi,"_");this.appFields[d]=a.fields[c];for(var e=0;e<a.fields[c].qTags.length;e++)this.appFieldsByTag[a.fields[c].qTags[e]]||(this.appFieldsByTag[a.fields[c].qTags[e]]={}),this.appFieldsByTag[a.fields[c].qTags[e]][d]={fieldName:a.fields[c].qName},a.fields[c].qCardinal>b&&(this.appFieldsByTag.$possibleMeasure||(this.appFieldsByTag.$possibleMeasure={}),this.appFieldsByTag.$possibleMeasure[d]={fieldName:a.fields[c].qName})}for(var c=0;c<a.dimensions.length;c++){var d=a.dimensions[c].qData.title.toLowerCase().replace(/ /gi,"_");this.appFields[d]=a.dimensions[c],this.appFieldsByTag.$dimension||(this.appFieldsByTag.$dimension={}),this.appFieldsByTag.$dimension[d]={fieldName:a.dimensions[c].qData.title},a.fields[c].qCardinal>b&&(this.appFieldsByTag.$possibleMeasure||(this.appFieldsByTag.$possibleMeasure={}),this.appFieldsByTag.$possibleMeasure[d]={fieldName:a.fields[c].qName});for(var e=0;e<a.dimensions[c].qMeta.tags.length;e++){var f=a.dimensions[c].qMeta.tags[e];-1==f.indexOf("$")&&(f="$"+f),this.appFieldsByTag[f]||(this.appFieldsByTag[f]={}),this.appFieldsByTag[f][d]={fieldName:a.dimensions[c].qData.title}}}for(var c=0;c<a.measures.length;c++){var d=a.measures[c].qData.title.toLowerCase().replace(/ /gi,"_");this.appFields[d]=a.measures[c],this.appFieldsByTag.$measure||(this.appFieldsByTag.$measure={}),this.appFieldsByTag.$measure[d]={fieldName:a.measures[c].qData.title};for(var e=0;e<a.measures[c].qMeta.tags.length;e++){var f=a.measures[c].qMeta.tags[e];-1==f.indexOf("$")&&(f="$"+f),this.appFieldsByTag[f]||(this.appFieldsByTag[f]={}),this.appFieldsByTag[f][d]={fieldName:a.measures[c].qData.title}}}console.log(this.appFieldsByTag),this.fieldsFetched.deliver()}},searchStarted:{writable:!0,value:null},searchResults:{writable:!0,value:null},searchAssociations:{writable:!0,value:null},noResults:{writable:!0,value:null},chartResults:{writable:!0,value:null},suggestResults:{writable:!0,value:null}}),b}(),senseSearch=new SenseSearch;senseSearch.init();